<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MICER Posters</title>

<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 2em;
    background-color: #f3f4f6;
    color: #333;
  }

  h1 {
    margin-bottom: 1em;
    font-size: 2rem;
  }

  .filter-bar {
    margin-bottom: 1.5em;
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1em;
  }

  .search-input {
    padding: 10px 14px;
    font-size: 1rem;
    width: 260px;
    border: 1px solid #ccc;
    border-radius: 6px;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
    background-color: white;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  th, td {
    padding: 14px 16px;
    text-align: left;
    vertical-align: top;
  }

  thead th {
    background-color: #e5e7eb;
    font-weight: 600;
    color: #111827;
    border-bottom: 1px solid #d1d5db;
    user-select: none;
    cursor: pointer;
  }

  th.sortable::after {
    content: ' ⇅';
    font-size: 0.8em;
    color: #6b7280;
    padding-left: 4px;
  }

  th.sorted-asc::after {
    content: ' ▲';
  }

  th.sorted-desc::after {
    content: ' ▼';
  }

  tbody tr:hover {
    background-color: #f9fafb;
  }

  tbody td {
    border-top: 1px solid #e5e7eb;
  }

  td a {
    font-weight: 600;
    font-size: 1.125rem;
    color: #2563eb;
    text-decoration: none;
  }

  td a:hover {
    text-decoration: underline;
  }

  .description-cell {
    display: block;
    margin-top: 4px;
    font-size: 0.9rem;
    color: #4b5563;
  }

  .email {
    font-size: 0.9rem;
    color: #4b5563;
    margin-top: 4px;
  }
</style>
</head>

<body>
  <h1>MICER Poster Presentations</h1>

  <div class="filter-bar">
    <input type="text" id="searchInput" class="search-input" placeholder="Search all columns..." />
  </div>

  <table id="posterTable">
    <thead id="tableHead"></thead>
    <tbody id="tableBody"></tbody>
  </table>

<script>
  let tableData = [];
  let searchQuery = '';
  let currentSort = { column: null, direction: 'asc' };

  document.getElementById('searchInput').addEventListener('input', e => {
    searchQuery = e.target.value.toLowerCase();
    renderTable();
  });

  async function loadData() {
    const response = await fetch(
      'https://raw.githubusercontent.com/chem-ed/MICER26/main/data/data.json'
    );
    tableData = await response.json();
    renderTable();
  }

  function renderTable() {
    const head = document.getElementById('tableHead');
    const body = document.getElementById('tableBody');
    head.innerHTML = '';
    body.innerHTML = '';

    const columns = [
      'Entry',
      'Poster',
      'Presenter',
      'Affiliation',
      'Country'
    ];

    const headerRow = document.createElement('tr');
    columns.forEach(col => {
      const th = document.createElement('th');
      th.textContent = col;
      th.classList.add('sortable');
      th.onclick = () => sortBy(col);
      if (currentSort.column === col) {
        th.classList.remove('sortable');
        th.classList.add(
          currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc'
        );
      }
      headerRow.appendChild(th);
    });
    head.appendChild(headerRow);

    let filtered = tableData.filter(row =>
      Object.values(row).some(val =>
        String(val).toLowerCase().includes(searchQuery)
      )
    );

    if (currentSort.column) {
      filtered.sort((a, b) => {
        const valA = getSortValue(a);
        const valB = getSortValue(b);
        return currentSort.direction === 'asc'
          ? valA.localeCompare(valB)
          : valB.localeCompare(valA);
      });
    }

    filtered.forEach(row => {
      const tr = document.createElement('tr');

      // Entry
      tr.appendChild(td(row.Entry));

      // Poster
      const posterTd = document.createElement('td');
      const posterLink = document.createElement('a');
      posterLink.href = row.Link_Poster;
      posterLink.target = '_blank';
      posterLink.textContent = row.Poster_Title;
      posterTd.appendChild(posterLink);

      const abstract = document.createElement('div');
      abstract.className = 'description-cell';
      abstract.textContent = row.Poster_Abstract;
      posterTd.appendChild(abstract);
      tr.appendChild(posterTd);

      // Presenter
      const presenterTd = document.createElement('td');
      const profileLink = document.createElement('a');
      profileLink.href = row.Link_Profile;
      profileLink.target = '_blank';
      profileLink.textContent = `${row.LastName}, ${row.FirstName}`;
      presenterTd.appendChild(profileLink);

      const email = document.createElement('div');
      email.className = 'email';
      email.textContent = row.Email;
      presenterTd.appendChild(email);
      tr.appendChild(presenterTd);

      tr.appendChild(td(row.Affiliation));
      tr.appendChild(td(row.Country));

      body.appendChild(tr);
    });
  }

  function td(text) {
    const td = document.createElement('td');
    td.textContent = text || '';
    return td;
  }

  function sortBy(column) {
    if (currentSort.column === column) {
      currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
    } else {
      currentSort.column = column;
      currentSort.direction = 'asc';
    }
    renderTable();
  }

  function getSortValue(row) {
    if (currentSort.column === 'Poster') return row.Poster_Title || '';
    if (currentSort.column === 'Presenter') return row.LastName || '';
    return row[currentSort.column] || '';
  }

  loadData();
</script>
</body>
</html>
